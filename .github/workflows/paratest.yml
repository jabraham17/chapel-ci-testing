name: paratest linux64

on:
  workflow_dispatch:

concurrency:
  group: paratest-${{ github.ref }}
  cancel-in-progress: true
jobs:
  paratest:
    name: Run paratest
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/${{ github.repository }}/chapel:latest
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: run tests
        run: |
          # hack to workaround perl warning
          apt-get purge -y locales
          apt-get install -y locales
          locale-gen "en_US.UTF-8"
          dpkg-reconfigure locales
          export LANG=en_US.UTF-8
          export LC_ALL=en_US.UTF-8
          $CHPL_HOME/util/start_test $CHPL_HOME/test/release/examples
